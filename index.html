<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>D' Best Site</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module" src="rating.js"></script>
</head>
<body>
  <header>
    <h1>D' Best Site</h1>
    <input type="text" id="search" placeholder="Search videos..." />
  </header>

  <main>
    <div id="tag-filter"></div>
    <div id="video-container" class="grid"></div>
  </main>

  <script type="module">
    import videoData from './videos.json' assert { type: "json" };

    const videoContainer = document.getElementById("video-container");
    const searchInput = document.getElementById("search");
    const tagFilter = document.getElementById("tag-filter");

    // Collect all tags
    const allTags = [...new Set(videoData.flatMap(v => v.tags))];
    let activeTag = null;

    // Tag filter buttons
    allTags.forEach(tag => {
      const btn = document.createElement("button");
      btn.textContent = tag;
      btn.onclick = () => {
        activeTag = activeTag === tag ? null : tag;
        renderVideos();
      };
      tagFilter.appendChild(btn);
    });

    searchInput.addEventListener("input", renderVideos);

    function renderVideos() {
      const term = searchInput.value.toLowerCase();
      videoContainer.innerHTML = "";
      videoData
        .filter(v =>
          v.title.toLowerCase().includes(term) &&
          (!activeTag || v.tags.includes(activeTag))
        )
        .forEach(createVideoCard);
    }

    function createVideoCard(video) {
      const card = document.createElement("div");
      card.className = "video-card";

      card.innerHTML = `
        <h3>${video.title}</h3>
        <video src="${video.url}" controls playsinline></video>
        <div class="tags">${video.tags.map(t => `<span>#${t}</span>`).join(' ')}</div>
        <div class="rating-box" id="rating-${video.postId}">Loading rating...</div>
      `;

      videoContainer.appendChild(card);
      setupRatingSystem(video.postId);
    }

    renderVideos();
  </script>
  <script>
  document.addEventListener("contextmenu", e => e.preventDefault());
  document.querySelectorAll("video").forEach(video => {
    video.setAttribute("controlsList", "nodownload");
    video.addEventListener("contextmenu", e => e.preventDefault());
  });
</script>

</body>
</html>
