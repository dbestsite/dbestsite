<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>D' Best Site</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module" src="rating.js"></script>
</head>
<body>
  <header>
    <h1>D' Best Site</h1>
    <input type="text" id="search" placeholder="Search videos..." />
  </header>
  
  <main>
    <div id="tag-filter"></div><div id="ad1"></div>
    <div id="video-container" class="grid"></div><div id="ad2"></div><div id="ad3"></div>
    <div id="pagination" class="pagination-controls"></div>
  </main>




<script type="module">
  import { insertBannerAd } from './adBanner.js';

  // Insert banner ads in multiple places if you want
  insertBannerAd('ad1');
  insertBannerAd('ad2');  // duplicate in another container
  insertBannerAd('ad3');
</script>

	
  <script type="module">
    import { setupRatingSystem } from './rating.js';

    const videoContainer = document.getElementById("video-container");
    const searchInput = document.getElementById("search");
    const tagFilter = document.getElementById("tag-filter");
    const pagination = document.getElementById("pagination");

    let videoData = [];
    let filteredData = [];
    let currentPage = 1;
    const videosPerPage = 5;
    let activeTag = null;

    fetch('videos.json')
      .then(res => res.json())
      .then(data => {
        // Sort newest first
        videoData = data.reverse();
        initFilters();
        applyFilters();
      });

    function initFilters() {
      const allTags = [...new Set(videoData.flatMap(v => v.tags))];

      allTags.forEach(tag => {
        const btn = document.createElement("button");
        btn.textContent = tag;
        btn.onclick = () => {
          activeTag = activeTag === tag ? null : tag;
          applyFilters();
        };
        tagFilter.appendChild(btn);
      });

      searchInput.addEventListener("input", () => {
        applyFilters();
      });
    }

    function applyFilters() {
      const term = searchInput.value.toLowerCase();
      filteredData = videoData.filter(v =>
        v.title.toLowerCase().includes(term) &&
        (!activeTag || v.tags.includes(activeTag))
      );

      currentPage = 1;
      renderPagination();
      renderVideos();
    }

    function renderPagination() {
      pagination.innerHTML = "";
      const totalPages = Math.ceil(filteredData.length / videosPerPage);

      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        btn.className = i === currentPage ? "active" : "";
        btn.onclick = () => {
          currentPage = i;
          renderVideos();
          renderPagination();
        };
        pagination.appendChild(btn);
      }
    }

    function renderVideos() {
      videoContainer.innerHTML = "";
      const start = (currentPage - 1) * videosPerPage;
      const end = start + videosPerPage;
      const pageVideos = filteredData.slice(start, end);

      pageVideos.forEach(video => {
        const card = document.createElement("div");
        card.className = "video-card";

        card.innerHTML = `
          <h3>${video.title}</h3>
          <video src="${video.url}" controls playsinline controlsList="nodownload"></video>
          <div class="tags">${video.tags.map(t => `<span>#${t}</span>`).join(' ')}</div>
          <div class="rating-box" id="rating-${video.postId}">Loading rating...</div>
        `;

        videoContainer.appendChild(card);
        setupRatingSystem(video.postId, video.votes || 0, video.sum || 0);

      });
    }

    // Disable right click globally
    document.addEventListener("contextmenu", e => e.preventDefault());
  </script>
</body>
</html>
